!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://static.proglib.io",n(n.s=386)}({0:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},1:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},153:function(e,t,n){},17:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return i}));var r={image:"image/*",resume:"application/msword,application/pdf"},o=function(e){return new Promise((function(t){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=document.createElement("input");return t.type="file",t.multiple=e.multiple,t.accept=e.accept,t.className="visually-hidden",t}(e);return document.body.appendChild(n),n.onchange=function(e){var r=event.target.files;t({files:r,input:n})},n.click(),n}))},i=function(e){return new Promise((function(t,n){var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}))}},30:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return 0==e.indexOf("http")||0==e.indexOf("data:image")?e:window.mediaDomainUrl+"/"+e}},386:function(e,t,n){"use strict";n.r(t);n(153);var r,o,i,a=n(7),c=n(39),u=function(e){return Array.from(e.children).filter((function(e){return e.classList.contains("comment")}))},s=n(6),l=n(78),d="data-fold",m="data-loading",f=function(e){e.more&&e.more.setAttribute(m,""),e.children.forEach((function(e){h(e.element)})),e.childrenList.removeAttribute(d)},h=function(e,t){var n=function e(t,n){var r=t.querySelector(".comment-entity"),o=r?r.querySelector('[data-reaction="like"]'):null,i=o?o.querySelector("[data-reaction-count]"):null,a={element:t,likesCount:i,created:t.dataset.created,children:[]};if(i&&(t.style.order=-1*(parseInt(i.textContent)||0)-1),!t)return a;if(!n)return a;n-=1;var c,s,l=t.querySelector(".comment__children");if(!l)return a;a.childrenList=l,a.more=(s=(c=l).dataset.commentId,c.querySelector('[data-more="'.concat(s,'"]')));var d=u(l);return a.children=d.map((function(t){return e(t,n)})),a.childrenCount=a.children.reduce((function(e,t){return e+(t.childrenCount||0)+1}),0),a}(e,4);if(n.childrenCount>2){var r=n.children.reduce((function(e,t){return t.childrenCount>2?e+1:e+t.childrenCount+1}),0);t?f(n):function(e,t){e.childrenList.setAttribute("data-fold",""),function(e){return e.sort((function(e,t){return t.created-e.created})),e[0]}(e.children).element.classList.add("recent"),e.more.textContent=t+" "+Object(c.a)(t,["ответ","ответа","ответов"]),e.more.addEventListener("click",(function(t){f(e)}))}(n,r)}},v=function(){var e=new URL(window.location.href),t=e.searchParams.get("comment");if(t){var n=r.querySelector('.comment-entity[data-id="'.concat(t,'"]'));if(n){!function(e){for(var t=[],n=e.closest(".comment__children");n;){var r=n.closest(".comment");if(!r)break;n=r.closest(".comment__children"),r&&t.push(r)}t.reverse().forEach((function(e){var t=e.closest(".comment");h(t,"open")}))}(n);var o=e.searchParams.get("action");if("answer"===o||"edit"===o){var i="answer"===o?"[data-comment-reply]":"[data-comment-edit]",a=n.querySelector(i);a&&a.click()}document.querySelector("#comment-".concat(t)).scrollIntoView()}}},p=function(e){return new Promise((function(t,n){var o=(r=e).dataset.action;o||n(),Object(a.a)(o,{method:"POST"}).then((function(e){e.success?(e.html.trim()&&(r.innerHTML=e.html,r.querySelectorAll("a").forEach((function(e){return e.setAttribute("rel","noopener noreferrer nofollow")})),function(){u(r).forEach((function(e){h(e)}));var e=document.querySelector("[data-comments-filter]:not([data-hidden])");e&&(e.style.display="block")}(),r.querySelectorAll("picture img").forEach(l.a)),r.setAttribute("data-loaded",""),r.removeAttribute("data-error"),r.style.display="",Object(s.a)(document.body,"update.lazy"),v(),t()):(r.setAttribute("data-error",""),r.style.display="",n())})).catch((function(e){r.setAttribute("data-error",""),r.style.display="",console.error(e),n()}))}))},y=n(0),b=n.n(y),g=n(1),w=n.n(g),_=n(30),k=function(){function e(t,n){var r=this;b()(this,e),this._form=t,this._replaceFragment=new RegExp(this._form.dataset.replace,"g"),n.onCommentCreate&&"function"==typeof n.onCommentCreate&&(this.onCommentCreate=n.onCommentCreate.bind(this)),this.nodes={comment:this._form.querySelector('[name="commentContent"]'),previewContainer:this._form.querySelector("[data-previews]"),images:[],from:this._form.querySelector('[name="from_company"]')||{},previewTmp:this._form.querySelector("[data-preview-tmp]"),submit:this._form.querySelector('[type="submit"]')},this.nodes.comment.addEventListener("keydown",(function(e){window.checkAuth()||e.preventDefault()})),this._actions=this._form.dataset,this._form.onsubmit=function(e){if(e.preventDefault(),!window.checkAuth())return e.preventDefault(),!1;r._onSubmit()}}return w()(e,[{key:"urlsCount",get:function(){return this._form.querySelectorAll('[name="commentImgUrls[]"]').length}},{key:"form",get:function(){return this._form}},{key:"state",get:function(){return this._state},set:function(e){this._state=e;var t=this._form.dataset["".concat(e,"State")];this.entity&&(t=t.replace(this._replaceFragment,this.entity.id)),this._form.action=t}},{key:"entity",get:function(){return this._entity},set:function(e){this._entity=e}},{key:"text",get:function(){return this.nodes.comment.value},set:function(e){this.nodes.comment.value=e}},{key:"from",set:function(e){this.nodes.from.checked=!!e}},{key:"focus",value:function(){this.nodes.comment.focus()}},{key:"setData",value:function(e){var t=this;this.text=e.comment||"",this.from=e.from,e.images.forEach((function(e){t._createImageField(e)}))}},{key:"_createImageField",value:function(e){var t=this,n=document.createElement("input");n.type="hidden",n.name="commentImgUrls[]",n.value=e;var r=this.nodes.previewTmp.cloneNode(!0);r.querySelector("img").src=Object(_.a)(e),r.appendChild(n),this.nodes.previewContainer.appendChild(r);var o={input:n,preview:r};this.nodes.images.push(o),r.querySelector("[data-close]").addEventListener("click",(function(){t._deleteImage(o)}))}},{key:"_deleteImage",value:function(e){e.input.remove(),e.preview.remove();var t=this.nodes.images.indexOf(e);-1!==t&&this.nodes.images.splice(t,1)}},{key:"clear",value:function(){this.text="",this.nodes.images.forEach((function(e){e.preview.remove(),e.input.remove()})),this.nodes.images.length=0,this.nodes.previewContainer.innerHTML=""}},{key:"close",value:function(){this._form.remove()}},{key:"_onSubmit",value:function(){var e=this;this.nodes.submit.setAttribute("data-loading",""),this.nodes.submit.disabled=!0;var t=new FormData(this._form);Object(a.a)(this._form.action,{method:"POST",body:t}).then((function(t){e.nodes.submit.removeAttribute("data-loading"),e.nodes.submit.disabled=!1,e.onCommentCreate&&e.onCommentCreate(t)})).catch((function(t){e.nodes.submit.removeAttribute("data-loading"),e.nodes.submit.disabled=!1,console.error(t)}))}}]),e}(),S=function(){function e(t){b()(this,e),this.element=t,this._container=this.element.closest(".comment"),this._children=this._container.querySelector(".comment__children"),this._id=this.element.dataset.id,this.api={get:this.element.dataset.apiGet,delete:this.element.dataset.apiDelete},this.token={name:this.element.dataset.tokenName,value:this.element.dataset.token}}return w()(e,[{key:"id",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"getData",value:function(){var e=this;return new Promise((function(t,n){e.api.get||n("No get method"),Object(a.a)(e.api.get,{method:"GET"}).then((function(e){t(e)})).catch((function(e){n(e)}))}))}},{key:"delete",value:function(){var e=this;return new Promise((function(t,n){e.api.delete||n("No delete method");var r=new FormData;e.token.name&&r.append(e.token.name,e.token.value),Object(a.a)(e.api.delete,{method:"POST",body:r}).then((function(n){var r=!!n.html&&n.html.trim();r?e.updateComment(r):e._remove(),t(n)})).catch((function(e){n(e)}))}))}},{key:"updateComment",value:function(e){this.element.insertAdjacentHTML("beforeBegin",e),this.element.remove(),this.element=null}},{key:"_remove",value:function(){this._container.remove(),this.element=null,this.container=null}}]),e}(),C=function(e){var t=e.closest(".comment-entity");return!!t&&new S(t)},E=n(17),A=n(5),q=function(e,t){var n=e.querySelector("[data-add-files]"),r=e.querySelector("[data-previews]"),o=e.querySelector("[data-preview-tmp]");n&&n.addEventListener("click",(function(){e.querySelectorAll('[name="'.concat(t,'"]')).length>=2&&(A.a.open("Не больше 2 изображений",{state:"error"}),1)||E.c({multiple:!1,accept:E.a.image}).then((function(n){var i=n.files,a=n.input;a.name=t,e.appendChild(a),E.b(i[0]).then((function(e){var t=function(e,t,n){var r=e.cloneNode(!0);return r.querySelector("img").src=t,r.querySelector("[data-close]").addEventListener("click",(function(e){n()})),r}(o,e,(function(){a.remove(),t.remove()}));r.appendChild(t)}))}))}))},O=void 0,L=function(e,t){t.insertAdjacentHTML("afterBegin",e),t.firstElementChild.scrollIntoView({behavior:"smooth",block:"center"})},x=(o=Array.from(document.querySelectorAll("[data-comments]")),function(e){o.forEach((function(t){t.textContent=e;var n=t.closest("[data-ending]");n&&n.setAttribute("data-ending",Object(c.a)(e,c.a.KEYS))}))}),j=function(e){e.element.style.display=""},P=function(){var e,t=document.querySelector(".comments-feed");t&&p(t);var n=document.getElementById("create-comment-form");n&&(q(n,"commentFiles[]"),new k(n,{onCommentCreate:function(e){e.count&&x(e.count),L(e.html,t),this.clear(),document.body.dispatchEvent(new Event("feed.events.update"))}}));var r=document.getElementById("comments-form");r&&(q(r,"commentFiles[]"),i=new k(r,{onCommentCreate:function(e){e.count&&x(e.count);var t=this.entity;t&&("edit"==i.state?t.updateComment(e.html):L(e.html,t.children),t=null,this.entity=null,document.body.dispatchEvent(new Event("feed.events.update"))),this.close(),this.clear()},onCancelEdit:function(){O.close(),O.clear(),O.entity&&j(O.entity)}})),document.addEventListener("click",(function(t){if(!e){t.target.hasAttribute("data-comment-reply")&&function(e){var t=C(e);if(t){var n="";if(i.entity){if("answer"==i.state&&i.entity==t)return;"edit"==i.state?j(i.entity):"answer"==i.state&&(n=i.text)}i.clear(),i.entity=t,i.state="answer",i.text=n,t.element.appendChild(i.form),i.focus()}}(t.target);var n,r=t.target.closest("[data-comment-delete]");if(r){if(r.blocked)return;r.blocked=!0,r.setAttribute("data-loading",""),e=!0,(n=r,new Promise((function(e,t){var r=C(n);r&&window.confirm({question:"Это действие безвозвратно удалит ваш комментарий",confirmButton:"Удалить"}).then((function(){r.delete().then((function(t){x(t.count),e()})).catch((function(t){console.error(t),e()}))})).catch((function(e){return t(e)}))}))).then((function(){r.removeAttribute("data-loading"),r.blocked=!1,e=!1})).catch((function(){r.removeAttribute("data-loading"),r.blocked=!1,e=!1}))}var o=t.target.closest("[data-comment-edit]");if(o){if(o.blocked)return;o.blocked=!0,o.setAttribute("data-loading",""),e=!0,function(e){return new Promise((function(t){var n=C(e);if(n){if(i.entity){if("edit"==i.state){if(i.entity==n)return void t();j(i.entity)}i.clear()}i.entity=n,i.state="edit",n.getData().then((function(e){i.setData(e),Object(s.a)(document.body,"remove.modal"),n.element.parentElement.insertBefore(i.form,n.element),i.focus(),n.element.style.display="none",t()})).catch((function(e){console.error(e),t()}))}}))}(o).then((function(){o.removeAttribute("data-loading"),o.blocked=!1,e=!1}))}var a=t.target.closest("[data-to-parent]");if(a){var c=document.querySelector('[data-id="'.concat(a.dataset.toParent,'"]'));c&&(c.classList.remove("highlight"),setTimeout((function(){c.classList.add("highlight")}),0))}}}))};onDomReady.then((function(){return P()}))},39:function(e,t,n){"use strict";function r(e,t){return t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]}r.TAGS={dat:["тег","тега","тегов"],gen:["тег","тега","тегов"]},r.SYMBOLS={dat:["символ","символа","символов"],gen:["символа","символов","символов"]},r.WORDS={dat:["слово","слова","слов"],gen:["слова","слов","слов"]},r.MINUTES={dat:["минуту","минуты","минут"]},r.HOURS={dat:["час","часа","часов"]},r.KEYS=["one","few","more"],t.a=r},5:function(e,t,n){"use strict";var r=n(0),o=n.n(r),i=n(1),a=n.n(i),c=null,u=null,s=function(){(c=document.createElement("div")).classList.add("toast"),(u=document.createElement("div")).classList.add("toast__text"),c.appendChild(u),c.addEventListener("click",(function(){d.close()}))},l=null,d=function(){function e(){o()(this,e)}return a()(e,null,[{key:"close",value:function(){clearTimeout(l),c.remove(),c.classList.remove("shown")}},{key:"open",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c||s(),u.innerHTML=t,c.setAttribute("data-placement",n.place||"top-right"),c.setAttribute("data-state",n.state||"default"),document.body.appendChild(c),c.classList.add("shown"),"infinity"!==n.delay&&(l=setTimeout((function(){e.close()}),n.delay||5e3))}}]),e}();t.a=d},6:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({bubbles:!0,cancelable:!0},n),o=new Event(t,r);e.dispatchEvent(o)}},7:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r={403:"Запрещено",413:"Request Entity Too Large"},o=function(e,t){return t.headers||(t.headers={}),t.headers.Accept="application/json",new Promise((function(n,o){fetch(e,t).then((function(e){if(e.ok)return e;throw 401==e.status?(window.showAuthPopup(),new Error("not-auth")):new Error(e.status)})).then((function(e){n(e.json())})).catch((function(e){if("AbortError"===e.name);else{var t=r[e.message]||"Что-то пошло не так";o(t)}}))}))}},78:function(e,t,n){"use strict";function r(e){var t=e.closest("picture");if(t){var n=function(){var n=t.querySelector("source[srcset='".concat(e.currentSrc,"']"));n&&t.removeChild(n)};e.onerror=n,e.complete&&0===e.naturalWidth&&n()}}n.d(t,"a",(function(){return r}))}});
//# sourceMappingURL=comments.service.min.js.map